# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –≤ DeliveryMap

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–µ—Ä–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –∫–∞—Ä—Ç—ã –º–∞—Ä—à—Ä—É—Ç –Ω–µ —Å—Ç—Ä–æ–∏–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–æ–∑–Ω–∏–∫–∞–ª –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–æ–≤.

## –ü—Ä–∏—á–∏–Ω–∞

1. **–ü–µ—Ä–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** `customerLocation` –±—ã–ª `null` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
   - `useEffect` –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª—Å—è –∏–∑-–∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ `if (!customerLocation) return`
   - –ú–∞—Ä—à—Ä—É—Ç –Ω–µ —Å—Ç—Ä–æ–∏–ª—Å—è

2. **–í—Ç–æ—Ä–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª
   - `onDistanceCalculated` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö `useEffect`
   - –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ callback –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞–ª—Å—è
   - –≠—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä–∏–ª–æ `useEffect` —Å–Ω–æ–≤–∞
   - –¶–∏–∫–ª: useEffect ‚Üí callback ‚Üí re-render ‚Üí useEffect ‚Üí ...

## –†–µ—à–µ–Ω–∏–µ

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π –ª–æ–∫–∞—Ü–∏–∏ ‚úÖ

```typescript
// –ë–´–õ–û:
const [customerLocation, setCustomerLocation] = useState<{
  lat: number;
  lng: number;
} | null>(null);

// –°–¢–ê–õ–û:
const defaultCustomerLocation = {
  lat: 54.3520, // –¶–µ–Ω—Ç—Ä Gda≈Ñsk
  lng: 18.6466,
};

const [customerLocation, setCustomerLocation] = useState<{
  lat: number;
  lng: number;
}>(defaultCustomerLocation); // –°—Ä–∞–∑—É —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
```

### 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ useRef –¥–ª—è callback ‚úÖ

```typescript
// –ò—Å–ø–æ–ª—å–∑—É–µ–º ref –¥–ª—è callback —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
const onDistanceCalculatedRef = useRef(onDistanceCalculated);

useEffect(() => {
  onDistanceCalculatedRef.current = onDistanceCalculated;
}, [onDistanceCalculated]);

// –í useEffect –∏—Å–ø–æ–ª—å–∑—É–µ–º ref
if (onDistanceCalculatedRef.current) {
  onDistanceCalculatedRef.current(distanceKm, durationMinutes);
}
```

### 3. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ‚úÖ

```typescript
// –ë–´–õ–û:
}, [customerLocation, isLoaded, onDistanceCalculated]); // ‚ùå –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª

// –°–¢–ê–õ–û:
}, [customerLocation.lat, customerLocation.lng, isLoaded]); // ‚úÖ –¢–æ–ª—å–∫–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
```

### 4. –î–æ–±–∞–≤–ª–µ–Ω draggable –º–∞—Ä–∫–µ—Ä ‚úÖ

```typescript
<Marker
  position={customerLocation}
  draggable={true} // –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å
  onDragEnd={(e) => {
    if (e.latLng) {
      handleMapClick(e);
    }
  }}
/>
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å—Ä–∞–∑—É –≤–∏–¥–µ–Ω –º–∞—Ä—à—Ä—É—Ç –æ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –¥–æ —Ü–µ–Ω—Ç—Ä–∞ Gda≈Ñsk
2. –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –∏ –≤—Ä–µ–º—è —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç—É –æ–±–Ω–æ–≤–ª—è–µ—Ç –º–∞—Ä—à—Ä—É—Ç
4. –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞—Ç—å –∫—Ä–∞—Å–Ω—ã–π –º–∞—Ä–∫–µ—Ä
5. –ù–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
6. Performance –≤ –Ω–æ—Ä–º–µ

## –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/checkout
2. ‚úÖ –°—Ä–∞–∑—É –≤–∏–¥–µ–Ω –º–∞—Ä—à—Ä—É—Ç (—Å–∏–Ω—è—è –ª–∏–Ω–∏—è)
3. ‚úÖ –ë–ª–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ/–≤—Ä–µ–º—è
4. ‚úÖ –ö–ª–∏–∫ –Ω–∞ –∫–∞—Ä—Ç—É ‚Üí –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç
5. ‚úÖ –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∫—Ä–∞—Å–Ω–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞ ‚Üí –Ω–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç
6. ‚úÖ Console –±–µ–∑ –æ—à–∏–±–æ–∫ –∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### useRef Pattern –¥–ª—è callbacks

–≠—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–≥–¥–∞:
- Callback –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∫–∞–∫ prop
- –ù—É–∂–µ–Ω –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö useEffect
- –ú–æ–∂–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ

**–°—Ö–µ–º–∞:**
```
1. –°–æ–∑–¥–∞—ë–º ref —Å —Ç–µ–∫—É—â–∏–º callback
2. –û–±–Ω–æ–≤–ª—è–µ–º ref –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ callback (–æ—Ç–¥–µ–ª—å–Ω—ã–π useEffect)
3. –í –æ—Å–Ω–æ–≤–Ω–æ–º useEffect –∏—Å–ø–æ–ª—å–∑—É–µ–º ref.current
4. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–∏—Ç–∏–≤—ã (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, —Ñ–ª–∞–≥–∏)
```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

**1. useCallback –≤ —Ä–æ–¥–∏—Ç–µ–ª–µ:**
```typescript
const handleDistanceCalculated = useCallback((distance, duration) => {
  // ...
}, []); // –ü—É—Å—Ç—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

**2. useMemo –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:**
```typescript
const coords = useMemo(
  () => ({ lat: customerLocation.lat, lng: customerLocation.lng }),
  [customerLocation.lat, customerLocation.lng]
);
```

**3. Debounce –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤:**
```typescript
import { debounce } from 'lodash';

const debouncedCalculate = useMemo(
  () => debounce((location) => calculateRoute(location), 500),
  []
);
```

## –í—ã–≤–æ–¥—ã

‚úÖ **Best Practices:**
- –í—Å–µ–≥–¥–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π state —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
- –ò—Å–ø–æ–ª—å–∑—É–π useRef –¥–ª—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö callbacks
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ useEffect: —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–∏—Ç–∏–≤—ã
- –¢–µ—Å—Ç–∏—Ä—É–π –Ω–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ü–∏–∫–ª—ã (DevTools ‚Üí Performance)

‚ùå **–ò–∑–±–µ–≥–∞–π:**
- `null` –≤ state –µ—Å–ª–∏ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç
- Callbacks –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö –±–µ–∑ useRef/useCallback
- –û–±—ä–µ–∫—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö (–∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∏–º–∏—Ç–∏–≤—ã)

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ
